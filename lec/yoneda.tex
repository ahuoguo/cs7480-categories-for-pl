\chapter{Yoneda I: Deriving universal properties}


% Our first step towards the Yoneda perspective is to begin to characterize
% objects by their hom-sets:

% \vspace{0.2cm}

% \section{From typing rules to $\calC$-indexed functions}
Our goal is to systematically derive, from first principles (meaning, without any creativity), the universal
property that corresponds to products.
Products have typing rules like:
\begin{mathpar}
  \inferrule*
    {\Gamma \vdash M : A \pltimes B}
    {\Gamma \vdash \plfst{M} : A}
\end{mathpar}

Following the principle of ``terms are interpreted as morphisms'',
the above typing rule implies that a category that 
can interpret $\plfst{M}$ must have certain morphisms.
There are many such morphisms that come about 
from this typing rule, one for each possible type context $\Gamma$,
which we can draw like this:

\begin{equation}
  % https://tikzcd.yichuanshen.de/#N4Igdg9gJgpgziAXAbVABwnAlgFyxMJZABgBpiBdUkANwEMAbAVxiRAB12BxOgW17oB9AIwgAvqXSZc+QijLCqtRizace-IQCZxkkBmx4CRMlqX1mrRB258BggMy6ph2UWGlF1C6usBBAAJOPF54AIAhAOd9aSM5ZC1SM28VKxA-aIMZY3lSB3NUtgA6EvElGCgAc3giUAAzACcIXiQyEBwIJAcUyzZKkRBqBjoAIxgGAAVYt2ssMGxYaMbm1uoOpAAWajGwKC62nzS6gaHR8anXHJA5hdYJeqaWxA92zsRu5V7rfp1TscnplcblhFvcQMsni91ogtp9fODBL8QMN-hdsnJrvMQXc9BCkIlXl0evD+k4-udARjgaDcY98Ws3rCURTLlSsYtiUdHGUxEA
\begin{tikzcd}
  {\color{red} \Gamma_1} \arrow[rd, "g_1" description, color = red] \arrow[rrdd, "f_1" description, bend left, color = red] &             &   \\
  {\color{blue}\Gamma_2} \arrow[r, "g_2" description, color = blue] \arrow[rrd, "f_2" description, color = blue]              & A \times B  &   \\
  {\color{orange} \Gamma_3} \arrow[ru, "g_3" description, color = orange] \arrow[rr, "f_3" description, color = orange]              &             & A \\
  ...                                                                               &             &  
  \end{tikzcd}
  \label{cd:indexed-fam}
\end{equation}

As in prior chapters,
we can extract equations of morphisms from 
equations we know must hold about programs. For instance, we know that 
$\plfst{M}$ is invariant under substitution for some (possibly multi-way)
substitution $s$:
\begin{align*}
  (\plfst{M})[s] = \plfst{(M[s])}
\end{align*}

We can translate this invariance under under substitution into morphism equalities 
that must hold in \ref{cd:indexed-fam}. First, we can interpret substitution as
a morphism $s : \Gamma' \to \Gamma$. 

\begin{definition}[Hom-set]
  Let \(X\) and \(Y\) be objects of a category \(\calC\).
  The \emph{hom-set} of $\calC$ at $X$ and $Y$, 
  written \(\calC(X,Y)\),
  is the set of morphisms from \(X\) to \(Y\):
  \[
  \calC(X,Y) := \{f \mid \dom(f) = X, \cod(f) = Y\}.
  \]
\end{definition}
\marginnote{%
The word ``hom'' is an abbreviation of ``homomorphism'',
and the name hom-set comes from the fact many of the original motivating examples of categories
had morphisms that were homomorphisms between algebraic structures.
}




This equality corresponds to \(\mathsf{Fst}\) respecting composition:
\begin{align*}
  \mathsf{Fst}_\Gamma(f) \circ s = \mathsf{Fst}_{\Gamma'}(f \circ s)
\end{align*}
A parallel substitution from $\Gamma'$ to $\Gamma$ is a 
function sending each variable $x \in \Gamma$ to a term $\Gamma' \vdash s(x) : \Gamma(x)$.
For example, 
$s : \Gamma' \to \Gamma$




The premise of the judgment will be the domain of the function, 
and the conclusion of the judgment will be the codomain, like so:
\begin{align}
  \mathsf{Fst}_\Gamma : \calC(\Gamma, A \times B) \to \calC(\Gamma,A)
\end{align}
Let's pause to inspect the unusual shape of this function.
First, observe that this is a function between two sets: this is \emph{not} a
morphism in the category $\calC$.  Second, it is a function between two sets of
morphisms with the same domain, $\Gamma$.  And third, the function is
\emph{indexed by $\Gamma$}, written with a subscript. We can visualize elements 
of this family of ``$\mathsf{Fst}$-like morphisms'' as follows:



There may be many morphisms that satisfy the type signature of $\mathsf{Fst}$, 
but the key is that there are relatively few that are 
\emph{invariant under the choice of $\Gamma$}. Concretely, if 
there are is a morphism $s : \Gamma' \to \Gamma$ that relates $\Gamma'$ to $\Gamma$,



We will build towards the idea that there is some family of ``\textsf{Fst}-like
functions'' that ought to behave coherently for different choices of context
$\Gamma$.  The notion of coherence we need is stability under parallel substitution.


\marginnote{For a particular object $X$, the $\calC$-indexed set at $X$ is 
often also called the \emph{presheaf of $X$}.}
\begin{definition}[$\calC$-indexed set]
  A \emph{\(\calC\)-indexed set}
  consists of a family of sets \(PX\) indexed by objects \(X\) of \(\calC\),
  along with ``substitution functions'' \(Pf : PY \to PX\)
  for each morphism \(f : X \to Y\) in \(C\).
  Given an element \(y \in PY\)
  and a morphism \(f : X \to Y\),
  the element \((Pf)(y)\) will be written \(y \cdot_P f\)
  and called the ``substitution of \(y\) by \(f\)''.
  Every \(\calC\)-indexed set \(P\)
  must satisfy the following laws:
  \begin{itemize}
  \item Identity: \(x \cdot_P \idt_X = x\) for all objects \(X\) and \(x \in PX\)
  \item Composition: \(z \cdot_P (f\circ g) = z \cdot_P f \cdot_P g\)
    for all objects \(f : Y \to Z\) and \(g : X \to Y\) and \(z \in PZ\).
  \end{itemize}
\end{definition}


\begin{definition}[$\calC$-indexed function]
  \sloppy
  Let \(P\) and \(Q\) be \(\calC\)-indexed sets.
  A \emph{\(\calC\)-indexed function}
  from \(P\) to \(Q\),
  written \(\alpha : P \Rightarrow Q\),
  is a family of functions \(\alpha_X : PX \to QX\)
  that ``respects substitution''
  in the sense that \(\alpha_{X'}(x\cdot_P p) = \alpha_X(x)\cdot_p p\).
\end{definition}

\begin{itemize}
\item \(\calC\)-indexed functions can be composed:
  the composition of \(\alpha : Q \Rightarrow R\)
  and \(\beta: P \Rightarrow Q\),
  written \(\alpha\circ\beta : P \Rightarrow R\),
  is defined by \((\alpha\circ\beta)_X = \alpha_X \circ \beta_X\).
\item For each \(\calC\)-indexed set \(P\),
  there is a \(\calC\)-indexed function \(\idt_P : P \Rightarrow P\)
  defined by \(\idt_{P,X} = \left(PX \xrightarrow{\idt_{PX}} PX\right)\).
\end{itemize}
By now you may have noticed that \(\calC\)-indexed sets and functions
look like they ought to form a category. More on this later.


\marginnote{The symbol $\yo$ is pronounced ``yo''.}
\begin{definition}[Representable set]
  The \emph{representable \(\calC\)-indexed set at \(X\)}
  is written \(\yo X\) and defined by
  \begin{align}
    (\yo X)(A) &= \text{the set of morphisms \(A \to X\)} \\
    (\yo X)(A)(s : A' \to A) &= (f : A \to X) \mapsto (f \circ s : A' \to X)
  \end{align}
\end{definition}

Rules with multiple premises correspond to functions that take in multiple arguments.
For example,
\begin{mathpar}
  \inferrule*
    {\Gamma \vdash M : A
      \\
     \Gamma \vdash N : B
    }
    {\Gamma \vdash \plpair{M}{N} : A \pltimes B}
\end{mathpar}
becomes a function:
\begin{align*}
  \mathsf{Pair}_\Gamma : \calC(\Gamma,A) \times \calC(\Gamma,B) \to \calC(\Gamma,A\times B)
\end{align*}
Note that the product above is \emph{Cartesian product of sets}. The ability to 
form this product does not depend on $\calC$ having products.


\todo{product of $\calC$-indexed sets defn}

\section{Deriving a universal property for products}

With this dictionary in hand, we can translate the standard definition of product types into category theory.

\marginnote{Note that we are not presupposing in this definition that $\calC$ \emph{has} products}
\begin{definition}[PL-product]
  \sloppy
  Let \(A\) and \(B\) be objects of a category \(\calC\).
  A \emph{PL-product} of \(A\) and \(B\) consists of:
  \begin{itemize}
  \item An object \(A \times B\)
  \item $\calC$-indexed functions:
    \begin{align*}
      \mathsf{Fst}_\Gamma &: \calC(\Gamma,A\times B) \to \calC(\Gamma,A) \\
      \mathsf{Snd}_\Gamma &: \calC(\Gamma,A\times B) \to \calC(\Gamma,B) \\
      \mathsf{Pair}_\Gamma &: \calC(\Gamma,A)\times\calC(\Gamma,B) \to \calC(\Gamma,A\times B)
    \end{align*}
  \end{itemize}
  satisfying the necessary properties to be $\calC$-indexed, i.e.: 
  \begin{itemize}
  \item \(\mathsf{Fst}\), \(\mathsf{Snd}\), and \(\mathsf{Pair}\) ``respect substitution'': for all
    \(\Gamma'\xrightarrow{s}\Gamma\),
    \begin{align*}
      \mathsf{Fst}_{\Gamma}(f)\circ s &= \mathsf{Fst}_{\Gamma'}(f \circ s) & \text{for all \(\Gamma\xrightarrow{f} A \times B\)} \\
      \mathsf{Snd}_{\Gamma}(f)\circ s &= \mathsf{Snd}_{\Gamma'}(f \circ s) & \text{for all \(\Gamma\xrightarrow{f} A \times B\)} \\
      \mathsf{Pair}_{\Gamma}(f,g)\circ s &= \mathsf{Pair}_{\Gamma'}(f \circ s,g\circ s) & \text{for all \(\Gamma\xrightarrow{f} A\) and \(\Gamma\xrightarrow{g} B\)}
    \end{align*}
  \item Analogs of the \(\beta\) and \(\eta\) laws hold:
    \begin{align*}
      \mathsf{Fst}_{\Gamma}(\mathsf{Pair}_{\Gamma}(f,g)) &= f   & \text{for all \(\Gamma\xrightarrow{f} A\) and \(\Gamma\xrightarrow{g} B\)} \\
      \mathsf{Snd}_{\Gamma}(\mathsf{Pair}_{\Gamma}(f,g)) &= g   & \text{for all \(\Gamma\xrightarrow{f} A\) and \(\Gamma\xrightarrow{g} B\)} \\
      \mathsf{Pair}_\Gamma(\mathsf{Fst}_\Gamma(f),\mathsf{Snd}_\Gamma(f)) &= f   & \text{for all \(\Gamma\xrightarrow{f} A\times B\)}
    \end{align*}
  \end{itemize}
\end{definition}

\todo{PL product is equivalent to having a representation for the product of $\calC$-indexed sets.}

\begin{construction} \label{cons:pl-prod-to-prod}
  Any PL-product can be turned into a categorical product.
\end{construction}
\begin{proof}
  Suppose given a PL-product of two objects \(A\) and \(B\) of a category \(\calC\).
  Unpacking this, we have an object \(A \times B\)
  and functions \(\mathsf{Fst}_\Gamma\), \(\mathsf{Snd}_\Gamma\), and \(\mathsf{Pair}_\Gamma\)
  that respect substitution and satisfy the \(\beta\) and \(\eta\) laws.

  We will show how to use this information to turn the object \(A \times B\)
  into a categorical product of \(A\) and \(B\).
  To do this we will need to build morphisms
  \begin{align*}
  \mathsf{fst} &: A \times B \to A\\
  \mathsf{snd} &: A \times B \to B
  \end{align*}
  that satisfy the universal property of products.

  These morphisms can be defined in terms of the functions \(\mathsf{Fst}\) and \(\mathsf{Snd}\).
  To see how, let's take a closer look at the type of \(\mathsf{Fst}\).
  \[
    \mathsf{Fst}_\Gamma : \calC(\Gamma, A\times B) \to \calC(\Gamma, A)
    \qquad\text{for all objects \(\Gamma\)}
  \]
  How can we get a morphism from \(A \times B\) to \(A\) out of this function?
  For starters, we have to evaluate the function on an input in order to get anything from it at all.
  The type of \(\mathsf{Fst}_\Gamma\) indicates that if we input a morphism from \(\Gamma\) to \(A \times B\),
  then we will get back a morphism from \(\Gamma\) to \(A\).
  To get back a morphism \(A \times B\) to \(A\), then, we should set \(\Gamma = A \times B\):
  \[
    \mathsf{Fst}_{A\times B}: \calC(A \times B, A\times B) \to \calC(A \times B, A)
  \]
  Now all we need to do is find a morphism from \(A \times B\) to itself to give
  to this function as input. But there is always a natural choice of such a morphism, namely the identity \(\idt_{A\times B}\) on \((A \times B)\)!
  This gives us a definition of \(\mathsf{fst}\).
  \[
    \mathsf{fst} := \mathsf{Fst}_{A\times B}(\idt_{A\times B})
  \]
  Symmetrically, we can define a morphism \(\mathsf{snd}\) from \(A \times B\) to \(B\)
  in terms of \(\mathsf{Snd}\):
  \[
    \mathsf{snd} := \mathsf{Snd}_{A\times B}(\idt_{A\times B})
  \]

  Now all that's left is to show that \((A\times B, \mathsf{fst},\mathsf{snd})\) satisfies the universal property
  of product. For this, consider an arbitrary pair of morphisms \(\Gamma \xrightarrow{f} A\) and \(\Gamma\xrightarrow{g} B\).
  We must find a unique \(\Gamma \xrightarrow{h} A \times B\) satisfying \(\mathsf{fst} \circ h = f\) and \(\mathsf{snd} \circ h = g\).

  Set \(h = \mathsf{Pair}_\Gamma(f,g)\). This choice of \(h\) satisfies \(\mathsf{fst}\circ h = f\):
  \begin{align*}
    \mathsf{fst} \circ h
    &= \mathsf{Fst}_{A\times B}(\idt_{A\times B}) \circ \mathsf{Pair}_{\Gamma}(f,g) & \text{unwinding definitions} \\
    &= \mathsf{Fst}_{\Gamma}(\mathsf{Pair}_{\Gamma}(f,g)) & \text{\(\mathsf{Fst}\) respects substitution} \\
    &= f & \text{\(\beta\)}
  \end{align*}
  The symmetrical argument shows \(\mathsf{snd} \circ h = g\).

  To show uniqueness, suppose \(h'\) satisfies \(\mathsf{fst} \circ h = f\) and \(\mathsf{snd} \circ h = g\).
  Then the following calculation uses the \(\eta\) law to establish that \(h' = h\).
  \begin{align*}
    h' &= \mathsf{Pair}_\Gamma(\mathsf{Fst}_\Gamma(h'),\mathsf{Snd}_\Gamma(h')) & \text{\(\eta\)} \\
     &= \mathsf{Pair}_\Gamma(\mathsf{Fst}_{A\times B}(\idt_{A\times B})\circ h',\mathsf{Snd}_{A\times B}(\idt_{A\times B})\circ h') & \text{substitution} \\
     &= \mathsf{Pair}_\Gamma(\mathsf{fst}\circ h',\mathsf{snd}\circ h') & \\
     &= \mathsf{Pair}_\Gamma(f,g) & \text{assumption} \\
     &= \mathsf{Pair}_\Gamma(\mathsf{fst}\circ h,\mathsf{snd} \circ h) & \text{shown above} \\
     &= \mathsf{Pair}_\Gamma(\mathsf{Fst}_{A\times B}(\idt_{A\times B})\circ h,\mathsf{Snd}_{A\times B}(\idt_{A\times B}) \circ h) & \\
     &= \mathsf{Pair}_\Gamma(\mathsf{Fst}_\Gamma(h),\mathsf{Snd}_\Gamma(h)) & \text{substitution} \\
     &= h & \text{\(\eta\)}
  \end{align*}

\end{proof}

We can also go in the other direction: every product in the ordinary categorical sense can be turned into a PL-product.

\begin{construction} \label{cons:prod-to-pl-prod}
  Any product can be turned into a PL-product.
\end{construction}
\begin{proof}
  The previous construction provides a strong hint as to how to do this one.
  Given a product \((A\times B, \mathsf{fst}, \mathsf{snd})\), define
  \begin{align*}
    \mathsf{Fst}_\Gamma(f) &= \mathsf{fst} \circ f \\
    \mathsf{Snd}_\Gamma(f) &= \mathsf{snd} \circ f
  \end{align*}
  for all morphisms \(\Gamma \xrightarrow{f} A \times B\),
  and
  \begin{align*}
    \mathsf{Pair}_\Gamma(f,g) &= \angled{f,g}
  \end{align*}
  for all morphisms \(\Gamma\xrightarrow{f} A\) and \(\Gamma\xrightarrow{g} B\).
  The fact that \(\mathsf{Fst}\) and \(\mathsf{Snd}\) respect substitution boil down to the following equations:
  \begin{align*}
    (\mathsf{fst} \circ f) \circ s &= \mathsf{fst} \circ (f \circ s)  \\
    (\mathsf{snd} \circ f) \circ s &= \mathsf{snd} \circ (f \circ s)
  \end{align*}
  The fact that \(\mathsf{Pair}\) respects substitution boils down to Proposition~\ref{prop:tupling-nat}.

  The \(\beta\) law follows from the equations \(\mathsf{fst} \circ \angled{f,g} = f\)
  and \(\mathsf{snd} \circ \angled{f,g} = g\),
  and the \(\eta\) law from the uniqueness property of \(\angled{f,g}\).
\end{proof}

\begin{proposition}
 Constructions
 \ref{cons:pl-prod-to-prod}
 and
 \ref{cons:prod-to-pl-prod}
 are mutually inverse.
\end{proposition}


\section{Yoneda perspective}

\todo{category theory is all about different perspectives. we saw 
how the order theoretic, algebraic, diagrammatic perspective gave us 
useful different insights into univeral constructions. 
what we've just seen is a new perspective on universal constructions:
we've transitioned from an internal view to an external view, internalized 
notion of product, fill in 
}

One way of thinking of these theorems is that they serve as a check that the
definitions for terminal object, product, and exponential are working as
expected.  The keyword here is ``internalization'': the terminal object is the
internalization of the singleton set, product is the internalization of
Cartesian product of sets, and exponential is the internalization of morphism.
Over the next several chapters we will be working towards understanding the 
famous \emph{Yoneda lemma}, widely regarded as one of the most important 
ideas in category theory. 
Like many big ideas in mathematics, there are a variety of perspectives one can 
have on the Yoneda lemma that lend themselves better to different intuitions.
The perspective we will be pursuing here is that 
the Yoneda lemma \emph{connects the internal to the external}.


%% \noindent In set theory, functions enjoy the following nice properties.
%% \begin{enumerate}
%% \item Extensional equality: two functions \(f,g : X \to Y\)
%%   are equal if and only if \(f(x) = g(x)\) for all elements \(x\) of \(X\).
%% \item Elementwise definition:
%%   to define a function \(f : X \to Y\),
%%   it suffices give a relation,
%%   called the \emph{graph of \(f\)},
%%   such that each element \(X\)
%%   is related exactly one element of \(Y\).
%% \end{enumerate}
%% The presence of elements makes functions much easier to work with.
%% For instance, compare the proof \(X \times (Y \times Z) \cong (X\times Y) \times Z\)
%% as sets with the abstract proof for an arbitrary category with products.

%% In this chapter we will see how to recover a similar kind of element-wise reasoning
%% style that works in an arbitrary category.
%% While objects of categories don't have elements,
%% they do have \emph{generalized elements},
%% which bring much of the benefits of elements in set theory
%% to working in arbitrary categories.

%% The starting point for this generalization is the following
%% proposition, which recasts ``element of a (finite) set'' into categorical language.
%% \begin{proposition}[Elements in \(\FinSet\)]
%%   Let \(X\) be an object of \(\FinSet\).
%%   Elements of \(X\) are in bijection
%%   with morphisms of \(\FinSet\)
%%   from \(1\) to \(X\).
%% \end{proposition}
%% In light of this proposition, properties (1) and (2)
%% above translate into the following statements about \(\FinSet\):
%% \begin{itemize}
%% \item \textbf{(Property 1)} Extensional equality:
%%   Two morphisms \(f,g : X \to Y\)
%%   in \(\FinSet\) are equal if and only if \(f \circ x = g \circ x\)
%%   for all morphisms \(x : 1 \to X\).
%% \item \textbf{(Property 2)} Elementwise definition:
%%   to define a morphism \(f : X \to Y\)
%%   of \(\FinSet\),
%%   it suffices to give a relation \(R\)
%%   such that each
%%   morphism \(1 \to X\)
%%   is related to exactly one morphism \(1 \to Y\).
%% \end{itemize}

%% \sh{Let's slow down and give some concrete examples of
%% ``reasoning pointwise'' in finset. Give an example of
%% this element-wise definition.}

%% \sh{define the notion of ``testing'' objects in a
%% category by considering morphisms into them}

%% \section{From sets to categories}
%% \sh{Transition systems, canonical loop and canonical edge}

%% How to generalize the above situation to an arbitrary category?
%% An arbitrary category might not have a terminal object \(1\).
%% Even if they do, it's not guaranteed that functions can be
%% defined and tested for equality simply via morphisms \(1 \to X\).

%% The trick is to replace the special object \(1\)
%% with a \emph{quantification over all possible objects}.
%% Compare the statement of extensionality for \(\FinSet\)
%% above with the following proposition, which holds in any category:

%% \begin{proposition}[Generalized extensionality] \label{prop:generalized-extensionality}
%%   Let \(f,g : X \to Y\) be two morphisms in a category \(\calC\).
%%   Suppose that \(f \circ x = g \circ x\) for all objects \(\Gamma\)
%%   and all morphisms \(x : \Gamma \to X\).
%%   Then \(f = g\).
%% \end{proposition}
%% \begin{proof}
%%   Letting \(\Gamma = X\) and \(x = \idt_X\) gives \(f \circ \idt_X = g \circ \idt_X\).
%%   Simplifying yields \(f = g\).
%% \end{proof}

%% \begin{definition}[Generalized element]
%%   Let \(X\) and \(\Gamma\) be objects of a category \(\calC\).
%%   A \emph{generalized element of \(X\) at stage \(\Gamma\)}
%%   is a morphism \(x : \Gamma \to X\).
%%   The set of generalized elements of \(X\) at stage \(\Gamma\)
%%   will be written \(\genelt{X}{\Gamma}\).
%% \end{definition}

%% In this new language, Proposition~\ref{prop:generalized-extensionality}
%% says that two morphisms of a category are equal if
%% they act the same on all generalized elements.

%% Generalizing the principle of property 2, the elementwise definition,
%% is trickier. Since the single object \(1\) has been replaced by a quantification over
%% all objects \(\Gamma\), the notion of ``function'' as graph
%% needs to be adjusted similarly.

%% \begin{definition}[Generalized function]
%%   Let \(X,Y\) be objects of a category \(\calC\).
%%   A \emph{generalized function} \(\varphi\) from \(X\) to \(Y\)
%%   is a family of functions
%%   \(\varphi_\Gamma \subseteq \genelt{X}{\Gamma} \to \genelt{Y}{\Gamma}\)
%%   indexed by objects \(\Gamma\) of \(\calC\)
%%   that respects ``change of stage''
%%   in the sense that for all \(p : \Gamma' \to \Gamma\)
%%   and all \(x \in \genelt{X}{\Gamma}\)
%%   it holds that \(\varphi_\Gamma(x\circ p) = \varphi_\gamma(x)\circ p\).
%% \end{definition}

%% \begin{proposition}[Generalized elementwise definition]
%%   \label{prop:generalized-elementwise-definition}
%%   Let \(X,Y\) be objects of a category \(\calC\).
%%   Let \(\varphi\) be a generalized function from \(X\) to \(Y\).
%%   There exists a morphism \(f : X \to Y\)
%%   such that \(\varphi_\Gamma(x) = f \circ x\)
%%   for all objects \(\Gamma\) and all \(x \in \genelt{X}{\Gamma}\).
%% \end{proposition}

%% \begin{proposition}
%%   \(X \times (Y\times Z) \cong (X \times Y) \times Z\)
%%   in any category \(\calC\) with products.
%% \end{proposition}
%% \begin{proof}
%%   Let \(\varphi\) be a family of functions
%%   from generalized elements of \(X \times (Y\times Z)\)
%%   to generalized elements of \((X\times Y) \times Z\)
%%   defined as follows:
%%   \[
%%   \varphi_\Gamma\angled{x,\angled{y,z}}
%%   =\angled{\angled{x,y},z}
%%   \text{ for all \(x:\Gamma\to X,y:\Gamma\to Y,z:\Gamma\to Z\)}
%%   \]
%%   This function respects change of stage:
%%   \begin{align}
%%     \varphi_\Gamma\angled{x,\angled{y,z}}\circ p
%%     &= \angled{\angled{x,y},z}\circ p\\
%%     &= \angled{\angled{x\circ p,y\circ p},z \circ p}\\
%%     &= \varphi_\Gamma\angled{x\circ p,\angled{y\circ p,z\circ p}}\\
%%     &= \varphi_\Gamma(\angled{x,\angled{y,z}}\circ p).
%%   \end{align}
%%   Hence \(\varphi\) is a generalized function from \(X \times (Y\times Z)\)
%%   to \((X\times Y) \times Z\) and,
%%   by generalized elementwise definition,
%%   there exists a morphism \(f : X \times (Y\times Z) \to (X\times Y) \times Z\),
%%   such that \(f\circ \angled{x,\angled{y,z}}
%%   = \varphi_\Gamma\angled{x,\angled{y,z}}
%%   = \angled{\angled{x,y},z}\)
%%   for all objects \(\Gamma\) and morphisms \(x:\Gamma\to X,y:\Gamma\to Y,z:\Gamma\to Z\).

%%   Similarly, we can define a morphism \(g\) going the other way,
%%   in terms of the following generalized function \(\psi\):
%%   \[
%%   \psi_\Gamma\angled{\angled{x,y},z} = \angled{x,\angled{y,z}}.
%%   \]

%%   Now for
%%   all objects \(\Gamma\) and morphisms \(x:\Gamma\to X,y:\Gamma\to Y,z:\Gamma\to Z\),
%%   it holds that
%%   \begin{align}
%%     (f\circ g)\circ \angled{\angled{x,y},z}
%%     &= f\circ (g\circ \angled{\angled{x,y},z}) \\
%%     &= f\circ (\psi_\Gamma\angled{\angled{x,y},z}) \\
%%     &= f\circ \angled{x,\angled{y,z}} \\
%%     &= \varphi_\Gamma\angled{x,\angled{y,z}} \\
%%     &= \angled{\angled{x,y},z} \\
%%     &= \idt_{(X\times Y) \times Z} \circ \angled{\angled{x,y},z}
%%   \end{align}
%%   so \(f\circ g = \idt_{(X\times Y) \times Z}\)
%%   by generalized extensionality.

%%   An analogous argument gives \(g \circ f = \idt_{X\times (Y\times Z)}\).
%%   Hence \(f\) and \(g\) form an isomorphism
%%   between \(X \times (Y\times Z)\) and \((X\times Y) \times Z\).
%% \end{proof}
%% Note the similarity between this proof and the standard set-theoretic
%% argument that \(X \times (Y\times Z) \cong (X \times Y) \times Z\)
%% when \(X,Y,Z\) are sets.
%% The key differences in this more general setting are (1)
%% the quantification over stages \(\Gamma\)
%% and (2) the checks that generalized functions respect change of stage.

%% If you want to learn more about this perspective, check out
%% Tom Leinster's ``\href{https://webhomes.maths.ed.ac.uk/~tl/elements.pdf}{Doing without diagrams}''.

\chapter{Yoneda II: indexed set theory and representability}

Throughout this section we will work with an arbitrary catetgory \(\calC\).

\begin{definition}
  A \emph{\(\calC\)-indexed set}
  consists of a family of sets \(PX\) indexed by objects \(X\) of \(\calC\),
  along with ``substitution functions'' \(Pf : PY \to PX\)
  for each morphism \(f : X \to Y\) in \(C\).
  Given an element \(y \in PY\)
  and a morphism \(f : X \to Y\),
  the element \((Pf)(y)\) will be written \(y \cdot_P f\)
  and called the ``substitution of \(y\) by \(f\)''.
  Every \(\calC\)-indexed set \(P\)
  must satisfy the following laws:
  \begin{itemize}
  \item Identity: \(x \cdot_P \idt_X = x\) for all objects \(X\) and \(x \in PX\)
  \item Composition: \(z \cdot_P (f\circ g) = z \cdot_P f \cdot_P g\)
    for all objects \(f : Y \to Z\) and \(g : X \to Y\) and \(z \in PZ\).
  \end{itemize}
\end{definition}

\begin{example}
  Recall that \(\mathsf{STLC}\) is a category
  whose objects are types and whose morphisms \(A \to B\)
  are terms \(x : A \vdash M : B\) quotiented by \(\beta\eta\)-equivalence.
  For each type \(A\),
  the following defines a \(\mathsf{STLC}\)-indexed set \(\mathsf{Tm}(A)\):
  \begin{align}
  \mathsf{Tm}(B)(A) &= \text{the set of morphisms \(A\to B\)} \\
  \mathsf{Tm}(B)(N : A'\to A)
  &= (x\ofty A \vdash M : B) \mapsto (x'\ofty A' \vdash M[N/x] : B)
  \end{align}
\end{example}
This example is a special case of a canonical kind of \(\calC\)-indexed set.
\begin{definition}
  The \emph{representable \(\calC\)-indexed set at \(X\)}
  is written \(\yo X\) and defined by
  \begin{align}
    (\yo X)(A) &= \text{the set of morphisms \(A \to X\)} \\
    (\yo X)(A)(s : A' \to A) &= (f : A \to X) \mapsto (f \circ s : A' \to X)
  \end{align}
\end{definition}

\begin{definition}
  \sloppy
  Let \(P\) and \(Q\) be \(\calC\)-indexed sets.
  A \emph{\(\calC\)-indexed function}
  from \(P\) to \(Q\),
  written \(\alpha : P \Rightarrow Q\),
  is a family of functions \(\alpha_X : PX \to QX\)
  that ``respects substitution''
  in the sense that \(\alpha_{X'}(x\cdot_P p) = \alpha_X(x)\cdot_p p\).
\end{definition}

\begin{itemize}
\item \(\calC\)-indexed functions can be composed:
  the composition of \(\alpha : Q \Rightarrow R\)
  and \(\beta: P \Rightarrow Q\),
  written \(\alpha\circ\beta : P \Rightarrow R\),
  is defined by \((\alpha\circ\beta)_X = \alpha_X \circ \beta_X\).
\item For each \(\calC\)-indexed set \(P\),
  there is a \(\calC\)-indexed function \(\idt_P : P \Rightarrow P\)
  defined by \(\idt_{P,X} = \left(PX \xrightarrow{\idt_{PX}} PX\right)\).
\end{itemize}
By now you may have noticed that \(\calC\)-indexed sets and functions
look like they ought to form a category. More on this later.

\begin{definition}
  Two \(\calC\)-indexed sets \(P,Q\)
  are \emph{isomorphic}
if there are \(\calC\)-indexed functions \(\alpha : P \Rightarrow Q\)
and \(\beta : Q \Rightarrow P\)
such that \(\alpha\circ\beta=\idt_Q\) and \(\beta\circ\alpha=\idt_P\).
\end{definition}

\begin{definition}
  A \(\calC\)-indexed set \(P\) is \emph{representable}
  if there is an isomorphism \(\alpha : P \cong \yo X : \beta\)
  for some object \(X\) of \(\calC\).
\end{definition}

\chapter{Yoneda III: universal constructions, elements, and properties}

\begin{definition}
  \sloppy
  Given two \(\calC\)-indexed sets \(P\) and \(Q\),
  their \emph{product} \(P\times Q\)
  is the \(\calC\)-indexed set defined by
  \((P\times Q)(X) = P(X)\times Q(X)\),
  with substitution defined by
  \((x,y)\cdot_{P\times Q} p = (x\cdot_P p, y\cdot_Q p)\).
\end{definition}

\begin{proposition}
  Let \(X\) and \(Y\) be two objects of a category \(\calC\).
  An object \(P\) is a product of \(X\) and \(Y\)
  if and only if \(\yo P\) is isomorphic to \(\yo X \times \yo Y\).
\end{proposition}

\begin{definition}
  Given two objects \(X\) and \(Y\) of a category \(\calC\),
  there is a \(\calC\)-indexed set of \emph{closures},
  written \(\mathsf{Clos}(X,Y)\),
  defined by \(\mathsf{Clos}(X,Y)(\Gamma) = \calC(\Gamma\times X, Y)\),
  with substitution defined by
  \[
    \mathsf{Clos}(X,Y)(s : \Gamma'\to \Gamma)(f : \Gamma\times X \to Y)
    = \angled{\gamma',x} \mapsto f \circ \angled{s\circ \gamma', x}
  \]
  on generalized elements.
\end{definition}

\begin{proposition}
  Let \(X\) and \(Y\) be two objects of a category \(\calC\).
  An object \(E\) is the exponential \(Y^X\)
  if and only if \(\yo E\) is isomorphic to \(\mathsf{Clos}(X,Y)\).
\end{proposition}

\begin{proposition}
  Suppose the \(\calC\)-indexed set \(P\) is represented
  by the object \(X\).
  Then there exists an element \(u \in PX\),
  called the \emph{\(P\)-universal element},
  which satisfies the following \emph{universal property}:
  for any object \(\Gamma\) and any element \(g \in P\Gamma\),
  there exists a unique morphism \(\hat g : \Gamma \to X\)
  such that \(g = u \cdot_P \hat g\).
\end{proposition}

\begin{itemize}
\item In the case of the product, with \(\yo P \cong \yo X \times \yo Y\),
  the universal element is an element \(u \in \calC(P,X) \times \calC(P,Y)\),
  which is a pair of morphisms \(P\to X, P\to Y\).
  The universal property of this pair is that any other pair \(\Gamma \to X,\Gamma\to Y\)
  factors uniquely through it---precisely the universal property of products
\item In the case of exponents, with \(\yo E \cong \calC(A\times(-),B)\),
  the universal element is an element \(u \in \calC(A \times E,B)\),
  which is a morphism \(A \times E \to B\).
  The universal property of this morphism is that any other morphism
  \(A \times \Gamma \to B\)
  factors uniquely through it---precisely the universal property of exponents.
\end{itemize}

\chapter{Yoneda IV}

%% - Grothendieck universes
%% - The category Set
%% - Functors; opposite categories; C-indexed sets as functors
%% - Natural transformations; C-indexed functions as natural transformations
%% - The Yoneda lemma (without showing naturality in P,c)

%% \begin{itemize}
%% \item Functors form a category where morphisms are natural transformations \begin{itemize}
%%     \item Natural transformations as homotopies between diagrams
%%       (the \(C\to D^\to\) example revisited)
%%     \item Natural transformations as polymorphic maps
%%   \end{itemize}
%% \item Definition of Yoneda embedding
%% \item Restatement of universal properties from previous week in terms of Yoneda embedding
%% (e.g., for products, \(\yo(a\times b) \cong \yo(a)\times \yo(b)\).)
%% \item Yoneda embedding full and faithful. Use this to quickly prove some basic facts:
%%   associativity and commutativity of sums and products, distributivity of products over sums,
%%   ...
%%   These imply type isomorphisms in STLC and Set, entailments of propositional logic.
%% \item Yoneda preserves limits.
%%   This gives a quick proof that all limits can be constructed from products and equalizers.
%%   From this we can compute limits in STLC (it won't have all of them
%%   but it will have some).
%% \end{itemize}

%% \todo: \begin{itemize}
%% \item Slice over c is category of elements of yo c
%% \end{itemize}
